# 规则插入原规则前面（最高优先级）
+rules:
  # -------------------------------------------
  # Google Antigravity 全链路域名（精确匹配，避免 Fake-IP）
  # -------------------------------------------
  - DOMAIN,antigravity.google.com,AI
  - DOMAIN,antigravity.google.com.au,AI
  - DOMAIN,accounts.antigravity.google.com,AI
  - DOMAIN,api.antigravity.google.com,AI
  - DOMAIN,rpc.antigravity.google.com,AI
  - DOMAIN,download.antigravity.google.com,AI
  - DOMAIN,cdn.antigravity.google.com,AI
  - DOMAIN,assets.antigravity.google.com,AI
  - DOMAIN,storage.antigravity.google.com,AI
  - DOMAIN,fonts.antigravity.google.com,AI
  - DOMAIN-SUFFIX,antigravity.googleapis.com,AI
  - DOMAIN-KEYWORD,antigravity,AI

  # -------------------------------------------
  # Arc 浏览器全链路域名（原有配置，无改动）
  # -------------------------------------------
  # 1. 跳转拦截页
  - DOMAIN,browserinc.notion.site,AI
  - DOMAIN-SUFFIX,browserinc.com,AI
  
  # 2. 核心服务域名
  - DOMAIN-SUFFIX,arc.net,AI
  - DOMAIN,api.arc.net,AI
  - DOMAIN,auth.arc.net,AI
  - DOMAIN,account.arc.net,AI
  
  # 3. 下载相关域名
  - DOMAIN,download.arc.net,AI
  - DOMAIN-SUFFIX,downloads.arc.net,AI
  - DOMAIN-SUFFIX,arc-downloads.com,AI
  
  # 4. 资源与通信域名
  - DOMAIN-SUFFIX,cdn.arc.net,AI
  - DOMAIN-SUFFIX,assets.arc.net,AI
  - DOMAIN-SUFFIX,ws.arc.net,AI
  - DOMAIN-SUFFIX,wss.arc.net,AI
  - DOMAIN-SUFFIX,fonts.arc.net,AI
  
  # 5. 兜底匹配
  - DOMAIN-KEYWORD,arc,AI

  # -------------------------------------------
  # Dia 浏览器全链路域名（原有配置，无改动）
  # -------------------------------------------
  # 账号与地区验证核心域名
  - DOMAIN,account.diabrowser.engineering,AI
  - DOMAIN,identity.diabrowser.com,AI
  # 主域与子域
  - DOMAIN-SUFFIX,diabrowser.com,AI
  - DOMAIN-SUFFIX,diabrowser.engineering,AI
  - DOMAIN,api.diabrowser.com,AI
  # 资源与通信域名
  - DOMAIN-SUFFIX,diabrowserusercontent.com,AI
  - DOMAIN-SUFFIX,diabrowser.com.hk,AI
  - DOMAIN-SUFFIX,cdn.diabrowser.com,AI
  - DOMAIN-SUFFIX,ws.diabrowser.com,AI
  - DOMAIN-SUFFIX,wss.diabrowser.com,AI

  # -------------------------------------------
  # Comet 浏览器全链路域名（原有配置，无改动）
  # -------------------------------------------
  # 官方核心域名
  - DOMAIN-SUFFIX,perplexity.ai,AI
  - DOMAIN-SUFFIX,pplx.ai,AI
  # Comet 专属子域
  - DOMAIN-SUFFIX,comet.perplexity.ai,AI
  - DOMAIN,api.perplexity.ai,AI
  - DOMAIN,auth.perplexity.ai,AI
  # 资源与通信域名
  - DOMAIN-SUFFIX,cdn.perplexity.ai,AI
  - DOMAIN-SUFFIX,assets.perplexity.ai,AI
  - DOMAIN-SUFFIX,ws.perplexity.ai,AI
  - DOMAIN-SUFFIX,wss.perplexity.ai,AI
  # 备用兼容域名
  - DOMAIN-SUFFIX,identity.perplexity.ai,AI
  - DOMAIN-SUFFIX,docs.perplexity.ai,AI

# DNS 全局优化（专为修复 Antigravity Fake-IP 问题）
dns:
  enable: true
  ipv6: false
  enhanced-mode: redir-host
  listen: 0.0.0.0:53
  nameservers:
    - 1.1.1.1
    - 8.8.8.8
    - 119.29.29.29
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4
    ipv6: false
  domain-strategy:
    # 原有解析策略
    - match: '*.diabrowser.*'
      strategy: UseIP
    - match: '*.perplexity.ai'
      strategy: UseIP
    - match: '*.pplx.ai'
      strategy: UseIP
    - match: '*.arc.net'
      strategy: UseIP
    - match: 'browserinc.notion.site'
      strategy: UseIP
    - match: '*.browserinc.com'
      strategy: UseIP
    # Antigravity：逐域名强制 UseIP（返回真实 IP）
    - match: 'antigravity.google.com'
      strategy: UseIP
    - match: 'antigravity.google.com.au'
      strategy: UseIP
    - match: 'accounts.antigravity.google.com'
      strategy: UseIP
    - match: 'api.antigravity.google.com'
      strategy: UseIP
    - match: 'rpc.antigravity.google.com'
      strategy: UseIP
    - match: 'download.antigravity.google.com'
      strategy: UseIP
    - match: 'cdn.antigravity.google.com'
      strategy: UseIP
    - match: 'assets.antigravity.google.com'
      strategy: UseIP
    - match: 'storage.antigravity.google.com'
      strategy: UseIP
    - match: 'fonts.antigravity.google.com'
      strategy: UseIP
    - match: '*.antigravity.googleapis.com'
      strategy: UseIP

  fake-ip-filter:
    # 原有过滤规则
    - '*.diabrowser.com'
    - '*.diabrowser.engineering'
    - '*.perplexity.ai'
    - '*.pplx.ai'
    - '*.arc.net'
    - 'browserinc.notion.site'
    - '*.browserinc.com'
    - '*.arc-downloads.com'
    # Antigravity：逐个显式排除，确保不返回 Fake-IP
    - 'antigravity.google.com'
    - 'antigravity.google.com.au'
    - 'accounts.antigravity.google.com'
    - 'api.antigravity.google.com'
    - 'rpc.antigravity.google.com'
    - 'download.antigravity.google.com'
    - 'cdn.antigravity.google.com'
    - 'assets.antigravity.google.com'
    - 'storage.antigravity.google.com'
    - 'fonts.antigravity.google.com'
    - 'antigravity.googleapis.com'
    - '*.antigravity.googleapis.com'
